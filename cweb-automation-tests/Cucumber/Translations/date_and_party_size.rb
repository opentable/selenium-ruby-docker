# -*- coding: utf-8 -*-

$DAYS_OF_THE_WEEK = {
    "English" => {"Mon" => "Monday", "Tue" => "Tuesday", "Wed" => "Wednesday", "Thu" => "Thursday",
                  "Fri" => "Friday", "Sat" => "Saturday", "Sun" => "Sunday"
    },
    "Spanish" => {"Mon" => "lunes", "Tue" => "martes", "Wed" => "miércoles", "Thu" => "jueves",
                  "Fri" => "viernes", "Sat" => "sábado", "Sun" => "domingo"
    },
    "Japanese" => {"Mon" => "月", "Tue" => "火", "Wed" => "水", "Thu" => "木", "Fri" => "金", "Sat" => "土", "Sun" => "日"

    },
    "French" => {"Mon" => "lundi", "Tue" => "mardi", "Wed" => "mercredi", "Thu" => "jeudi",
                 "Fri" => "vendredi", "Sat" => "samedi", "Sun" => "dimanche"

    },
    "German" => {"Mon" => "Montag", "Tue" => "Dienstag", "Wed" => "Mittwoch", "Thu" => "Donnerstag",
                 "Fri" => "Freitag", "Sat" => "Samstag", "Sun" => "Sonntag"
    }
}

$DAYS_OF_THE_WEEK_SHORT_NAME = {
    "English" => {"Mon" => "Mon", "Tue" => "Tue", "Wed" => "Wed", "Thu" => "Thu",
                  "Fri" => "Fri", "Sat" => "Sat", "Sun" => "Sun"
    },
    "Spanish" => {"Mon" => "lun", "Tue" => "mar", "Wed" => "mié", "Thu" => "jue",
                  "Fri" => "vie", "Sat" => "sáb", "Sun" => "dom"
    },
    "Japanese" => {"Mon" => "月", "Tue" => "火", "Wed" => "水", "Thu" => "木", "Fri" => "金", "Sat" => "土", "Sun" => "日"

    },
    "French" => {"Mon" => "lun", "Tue" => "mar", "Wed" => "mer", "Thu" => "jeu",
                 "Fri" => "ven", "Sat" => "sam", "Sun" => "dim"

    },
    "German" => {"Mon" => "Mo", "Tue" => "Di", "Wed" => "Mi", "Thu" => "Do",
                 "Fri" => "Fr", "Sat" => "Sa", "Sun" => "So"
    }
}


$MONTH = {
    "English" => {"1" => "January", "2" => "February", "3" => "March", "4" => "April", "5" => "May", "6" => "June",
                  "7" => "July", "8" => "August", "9" => "September", "10" => "October", "11" => "November", "12" => "December"

    },
    "Spanish" => {"1" => "enero", "2" => "febrero", "3" => "marzo", "4" => "abril", "5" => "mayo", "6" => "junio",
                  "7" => "julio", "8" => "agosto", "9" => "septiembre", "10" => "octubre", "11" => "noviembre", "12" => "diciembre"
    },
    "Japanese" => {"1" => "1 月", "2" => "2 月", "3" => "3 月", "4" => "4 月", "5" => "5 月", "6" => "6 月",
                   "7" => "7 月", "8" => "8 月", "9" => "9 月", "10" => "10 月", "11" => "11 月", "12" => "12 月"

    },
    "French" => {"1" => "Janvier", "2" => "Février", "3" => "Mars", "4" => "Avril", "5" => "Mai", "6" => "Juin",
                 "7" => "Juillet", "8" => "Août", "9" => "Septembre", "10" => "Octobre", "11" => "Novembre", "12" => "Décembre"

    },
    "German" => {"1" => "Januar", "2" => "Februar", "3" => "März", "4" => "April", "5" => "Mai", "6" => "Juni",
                 "7" => "Juli", "8" => "August", "9" => "September", "10" => "Oktober", "11" => "November", "12" => "Dezember"
    }

}

$MONTH_SHORT_NAME = {
    "English" => {"1" => "Jan", "2" => "Feb", "3" => "Mar", "4" => "Apr", "5" => "May", "6" => "Jun",
                  "7" => "Jul", "8" => "Aug", "9" => "Sep", "10" => "Oct", "11" => "Nov", "12" => "Dec"

    },
    "Spanish" => {"1" => "ene", "2" => "feb", "3" => "mar", "4" => "abr", "5" => "may", "6" => "jun",
                  "7" => "jul", "8" => "ago", "9" => "sep", "10" => "oct", "11" => "nov", "12" => "dic"
    },
    "Japanese" => {"1" => "1 月", "2" => "2 月", "3" => "3 月", "4" => "4 月", "5" => "5 月", "6" => "6 月",
                   "7" => "7 月", "8" => "8 月", "9" => "9 月", "10" => "10 月", "11" => "11 月", "12" => "12 月"

    },
    "French" => {"1" => "janv", "2" => "févr", "3" => "mars", "4" => "avr", "5" => "mai", "6" => "juin",
                 "7" => "juil", "8" => "août", "9" => "sept", "10" => "oct", "11" => "nov", "12" => "déc"

    },
    "German" => {"1" => "Jan", "2" => "Febr", "3" => "Mrz", "4" => "Apr", "5" => "Mai", "6" => "Jun",
                 "7" => "Jul", "8" => "Aug", "9" => "Sept", "10" => "Okt", "11" => "Nov", "12" => "Dez"

    }

}

$PARTY_SIZE_FOR = {"English" => "for", "Spanish" => "grupo de", "Japanese" => "名様", "German" => "für", "French" => "pour"}

$PARY_SIZE_PEOPLE = {"English" => "people", "Spanish" => "personas", "Japanese" => "名様", "German" => "personen", "French" => "personnes"}

$PARY_SIZE_PERSON = {"English" => "Person", "Spanish" => "persona", "Japanese" => "名様", "German" => "Person", "French" => "personne"}

$Party_Size_Translation = {"English_US" => "Party Size", "English_GB" => "No. of diners", "Spanish" => "tamaño del grupo", "Japanese" => "人数", "German" => "Personen", "French" => "Nombre de personne(s)"}

$PARY_SIZE_Party_OF = {"English_US" => "Party of", "English_GB" => "Party of", "Spanish" => "Grupo de", "Japanese" => "名様", "German" => "Personen", "French" => "Nombre de personne(s)"}

#Convert date to  Xlarge date format
def long_date_format(date)
  convert_date_format(date, "%A %B %d %Y")
end

def long_date_format_without_day(date)
  convert_date_format(date, "%B %d %Y")
end

#Convert date to large date format
def large_date_format(date)
  if $domain.www_domain_selector.downcase == "www.opentable.jp"
    convert_date_format(date, "%A %B %d %Y")
  else
    convert_date_format(date, "%a %b %d %Y")
  end

end

#Convert date to medium date format
def medium_date_format(date)
  if $domain.www_domain_selector.downcase == "www.opentable.com.mx" || $domain.www_domain_selector.downcase == "www.opentable.de" ||
        $domain.www_domain_selector.downcase == "www.opentable.com/fr-ca"
    convert_date_format(date, "%d %m")
  elsif $domain.www_domain_selector.downcase == "www.opentable.co.uk" || $domain.www_domain_selector.downcase == "www.opentable.ie" || $domain.www_domain_selector.downcase == "www.opentable.com.au"
    convert_date_format(date, "%d %b")
  else
    convert_date_format(date, "%b %d")
  end

end

def convert_date_format(date, format)
  localized_month = nil
  localized_day_of_month = nil
  localized_day_of_week = nil
  localized_year = nil

  language_lookup_key = nil
  localized_complete_date = nil
  localized_date_format_long_date = nil
  localized_date_format_long_date_without_day_of_week = nil
  localized_date_format_large_date = nil
  localized_date_format_medium_date = nil


  case $domain.www_domain_selector.downcase
    when "www.opentable.com", "www.opentable.com.mx/en-us", "www.opentable.jp/en-us", "www.opentable.jp/en-gb"
      # long date format: Friday, June 29, 2012,     long date format w/o day:  June 29, 2012
      language_lookup_key = "English"
      localized_date_format_long_date = "%A, %B %d, %Y"
      localized_date_format_long_date_without_day_of_week = "%B %d, %Y"
      localized_date_format_large_date = "%a, %b %d, %Y"
      localized_date_format_medium_date = "%b %d"
    when "www.opentable.co.uk", "www.opentable.co.uk", "www.opentable.ie", "www.opentable.com.au"
      #long date format: Friday 29 June 2012      long date format w/o day:  June 29 2012
      language_lookup_key = "English"
      localized_date_format_long_date = "%A %d %B %Y"
      localized_date_format_long_date_without_day_of_week = "%B %d %Y"
      localized_date_format_large_date = "%a %d %b %Y"
      localized_date_format_medium_date = "%d %b"
    when "www.opentable.com.mx"
      # viernes, 29 de junio de 2012
      language_lookup_key = "Spanish"
      localized_date_format_long_date = "%A, %d de %B de %Y"
      localized_date_format_long_date_without_day_of_week = "%B de %d de %Y"
      localized_date_format_large_date = "%a, %d de %b de %Y"
      localized_date_format_medium_date = "%d/%m"
    when "www.opentable.jp"
      #2012 年 06 月 30 日 (水)
      language_lookup_key = "Japanese"
      #BOOK-1271: JP date display does not have year when browser width is maximized ie not responsive
      # localized_date_format_long_date = "%Y 年 %B %d 日 (%A)"
      # localized_date_format_long_date_without_day_of_week = "%Y 年 %B %d 日"
      # localized_date_format_large_date = "%Y 年 %B 月 %d 日 (%A)"
      localized_date_format_long_date = "%B %d 日"
      localized_date_format_long_date_without_day_of_week = "%B %d 日"
      localized_date_format_large_date = "%B %d 日"
      localized_date_format_medium_date = "%b %d 日"
    when "www.opentable.de"
      #Samstag, 30. Juni 2012
      language_lookup_key = "German"
      localized_date_format_long_date = "%A, %d. %B %Y"
      localized_date_format_long_date_without_day_of_week = "%d. %B %Y"
      localized_date_format_large_date = "%a, %d. %b %Y"
      localized_date_format_medium_date = "%d.%m"
    when "www.opentable.com/fr-ca"
      #samedi 30 juin 2012
      language_lookup_key = "French"
      localized_date_format_long_date = "%A %d %B %Y"
      localized_date_format_long_date_without_day_of_week = "%d %B %Y"
      localized_date_format_large_date = "%a. %d %b. %Y"
      localized_date_format_medium_date = "%d-%m"
    else
      raise Exception, "Unknown Domain: #{$domain.www_domain_selector}!"
  end

  if date.include? "."
    day, month, year = date.split "."
  elsif date.include? "/"
    day, month, year = date.split "/"
  elsif date.include? "-"
    year, month, day = date.split "-"
  else
    raise Exception, "Unknown Date format: #{date}"
  end

  year.chomp! ' '
  day.chomp! ' '
  month.chomp! ' '
  date = "#{year}-#{month}-#{day}"
  year = DateTime.parse(date).strftime('%Y')
  dw = DateTime.parse(date).strftime("%a")

  month.gsub!(/^0/, '')

  localized_day_of_week = $DAYS_OF_THE_WEEK[language_lookup_key][dw]
  localized_day_of_week_medium_name = $DAYS_OF_THE_WEEK_SHORT_NAME[language_lookup_key][dw]
  localized_month = $MONTH[language_lookup_key][month]
  localized_month_medium_name = $MONTH_SHORT_NAME[language_lookup_key][month]
  localized_day_of_month = day
  localized_year = year
  localized_month_full = DateTime.parse(date).strftime('%m') #.com.mx medium date format is a two digit month e.g. Jan = 01

  case format
    when "%A %B %d %Y"
      day.gsub!(/^0/, '')
      localized_complete_long_date = localized_date_format_long_date.sub("%A", localized_day_of_week).sub("%B", localized_month).sub("%d", localized_day_of_month).sub("%Y", localized_year)
    when "%B %d %Y"
      day.gsub!(/^0/, '')
      localized_complete_long_date_without_day_of_week = localized_date_format_long_date_without_day_of_week.sub("%B", localized_month).sub("%d", localized_day_of_month).sub("%Y", localized_year)
    when "%a %b %d %Y"
      day.gsub!(/^0/, '')
      localized_complete_large_date = localized_date_format_large_date.sub("%a", localized_day_of_week_medium_name).sub("%d", localized_day_of_month).sub("%b", localized_month_medium_name).sub("%Y", localized_year)
    when "%b %d"
      day.gsub!(/^0/, '')
      localized_complete_medium_date = localized_date_format_medium_date.sub("%b", localized_month_medium_name).sub("%d", localized_day_of_month)
    when "%d %b"
      day.gsub!(/^0/, '')
      localized_complete_medium_date = localized_date_format_medium_date.sub("%d", localized_day_of_month).sub("%b", localized_month_medium_name)
    when "%d %m"
      day.gsub!(/^0/, '')
      localized_complete_medium_date = localized_date_format_medium_date.sub("%d", localized_day_of_month).sub("%m", localized_month_full)


    else
      raise Exception, "Unknown format: date format #{format}!"
  end

end

def convert_date_to_domain_short_date(date)
  year = DateTime.parse(date).strftime('%Y')
  month = DateTime.parse(date).strftime('%m')
  day = DateTime.parse(date).strftime('%d')

  case $domain.www_domain_selector.downcase
    when "www.opentable.com"
      "#{month}/#{day}/#{year}"
    when "www.opentable.co.uk", "www.opentable.com.mx", "www.opentable.com/fr-ca", "www.opentable.com.mx/en-us", "www.opentable.ie", "wwww.opentable.com.au"
      "#{day}/#{month}/#{year}"
    when "www.opentable.jp", "www.opentable.jp/en-gb", "www.opentable.jp/en-us"
      "#{year}/#{month}/#{day}"
    when "www.opentable.de", "www.opentable.de/en-gb"
      "#{day}.#{month}.#{year}"
    else
      raise Exception, "Unknown Domain: #{$domain.www_domain_selector}!"
  end
end


def format_party_size(ps, format)
  ps = ps.to_s
  ps.gsub!(/[^0-9]/, '')
  for_ps = ""
  party_size = ""
  case $domain.www_domain_selector.downcase
    when "www.opentable.com", "www.opentable.com.mx/en-us", "www.opentable.jp/en-us", "www.opentable.jp/en-gb"
      people_ps = ps  + ' ' + $PARY_SIZE_PEOPLE["English"]
      for_ps = $PARTY_SIZE_FOR["English"] + ' ' + ps
      party_size = $Party_Size_Translation["English_US"] + ": " + ps
      party_of = $PARY_SIZE_Party_OF["English_US"] + " " + ps

    when "www.opentable.co.uk", "www.opentable.ie", "www.opentable.com.au"
      people_ps = ps + ' ' + $PARY_SIZE_PEOPLE["English"]
      for_ps = $PARTY_SIZE_FOR["English"] + ' ' + ps
      party_size = $Party_Size_Translation["English_GB"] + ":\n" + ps

      party_of = $PARY_SIZE_Party_OF["English_GB"] + " " + ps

    when "www.opentable.com.mx"
      people_ps = ps + ' ' + $PARY_SIZE_PEOPLE["Spanish"]
      for_ps = $PARTY_SIZE_FOR["Spanish"] + ' ' + ps
      party_size = $Party_Size_Translation["Spanish"] + ": " + ps
      party_of = $PARY_SIZE_Party_OF["Spanish"] + " " + ps

    when "www.opentable.jp"
      people_ps = ps + ' ' + $PARY_SIZE_PEOPLE["Japanese"]
      for_ps = ps + ' ' + $PARTY_SIZE_FOR["Japanese"]
      party_size = $Party_Size_Translation["Japanese"] + ": " + ps
      party_of = ps + ' ' + $PARY_SIZE_Party_OF["Japanese"]

    when "www.opentable.de"
      people_ps = ps + ' ' + $PARY_SIZE_PEOPLE["German"]
      for_ps = $PARTY_SIZE_FOR["German"] + ' ' + ps
      party_size = $Party_Size_Translation["German"] + ": " + ps
      party_of = $PARY_SIZE_Party_OF["German"] + ": " + ps

    when "www.opentable.com/fr-ca"
      people_ps = ps + ' ' + $PARY_SIZE_PEOPLE["French"]
      for_ps = $PARTY_SIZE_FOR["French"] + ' ' + ps
      party_size = $Party_Size_Translation["French"] + ": " + ps
      party_of = $PARY_SIZE_Party_OF["French"] + " : " + ps
    else
      raise Exception, "Unknown Domain: #{$domain.www_domain_selector}!"
  end

  case format
    when "people"
      people_ps
    when "ps only"
      ps
    when "for ps"
      for_ps
    when "Party Size:"
      party_size
    when "Party of"
      party_of
    else
      raise Exception, "Unknown pary size format: #{format}!"
  end

end

def convert_month_index(s_month)
  localized_month = nil
  case $domain.www_domain_selector.downcase
    when "www.opentable.com", "www.opentable.com.mx/en-us", "www.opentable.jp/en-us", "www.opentable.jp/en-gb"
      # long date format: Friday, June 29, 2012,     long date format w/o day:  June 29, 2012
      language_lookup_key = "English"

    when "www.opentable.co.uk", "www.opentable.co.uk", "www.opentable.de/en-gb", "www.opentable.ie", "www.opentable.com.au"
      #long date format: Friday 29 June 2012      long date format w/o day:  June 29 2012
      language_lookup_key = "English"

    when "www.opentable.com.mx"
      # viernes, 29 de junio de 2012
      language_lookup_key = "Spanish"

    when "www.opentable.jp"
      #2012 年 06 月 30 日 (水)
      language_lookup_key = "Japanese"

    when "www.opentable.de"
      #Samstag, 30. Juni 2012
      language_lookup_key = "German"

    when "www.opentable.com/fr-ca"
      #samedi 30 juin 2012
      language_lookup_key = "French"

    else
      raise Exception, "Unknown Domain: #{$domain.www_domain_selector}!"
  end

  if s_month.chomp.length > 4
    localized_month = $MONTH[language_lookup_key].invert[s_month]
  else
    localized_month = $MONTH_SHORT_NAME[language_lookup_key].invert[s_month]
  end
end
